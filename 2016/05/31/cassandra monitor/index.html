<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>cassandra monitor 方案评估 | web personal developer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="摘要最开始做cassandra monitor 方案的选型时，主要是从cassandra 本身入手，后来发现cassandra运行在JVM上，所有的metrics都是通过JMX 暴露出来。所以又可以使用一些通用的Java Application 的监控方案，作者在调查了很多的实现方案后，最终将范围缩小在graphite,newrelic,opscenter三种解决方案。本文只给出各自的优劣势，具体">
<meta property="og:type" content="article">
<meta property="og:title" content="cassandra monitor 方案评估">
<meta property="og:url" content="http://www.webpersonaldeveloper.cn/2016/05/31/cassandra monitor/index.html">
<meta property="og:site_name" content="web personal developer">
<meta property="og:description" content="摘要最开始做cassandra monitor 方案的选型时，主要是从cassandra 本身入手，后来发现cassandra运行在JVM上，所有的metrics都是通过JMX 暴露出来。所以又可以使用一些通用的Java Application 的监控方案，作者在调查了很多的实现方案后，最终将范围缩小在graphite,newrelic,opscenter三种解决方案。本文只给出各自的优劣势，具体">
<meta property="og:updated_time" content="2016-05-31T13:10:31.074Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="cassandra monitor 方案评估">
<meta name="twitter:description" content="摘要最开始做cassandra monitor 方案的选型时，主要是从cassandra 本身入手，后来发现cassandra运行在JVM上，所有的metrics都是通过JMX 暴露出来。所以又可以使用一些通用的Java Application 的监控方案，作者在调查了很多的实现方案后，最终将范围缩小在graphite,newrelic,opscenter三种解决方案。本文只给出各自的优劣势，具体">
  
    <link rel="alternate" href="/atom.xml" title="web personal developer" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <script type="text/javascript" src="http://tajs.qq.com/stats?sId=55880411" charset="UTF-8"></script>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?58ec1dc8b5972b468eb3098d1415a338";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

<header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">web personal developer</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Zoeken"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://www.webpersonaldeveloper.cn"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-cassandra monitor" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/05/31/cassandra monitor/" class="article-date">
  <time datetime="2016-05-31T13:00:20.723Z" itemprop="datePublished">2016-05-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      cassandra monitor 方案评估
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h1><p>最开始做cassandra monitor 方案的选型时，主要是从cassandra 本身入手，后来发现cassandra运行在JVM上，所有的metrics都是通过JMX 暴露出来。所以又可以使用一些通用的Java Application 的监控方案，作者<br>在调查了很多的实现方案后，最终将范围缩小在graphite,newrelic,opscenter三种解决方案。本文只给出各自的优劣势，具体选用哪种，相信读者自有判断。<br><a id="more"></a><br>想了解更多cassandra 知识请访问 <a href="http://www.webpersonaldeveloper.cn">http://www.webpersonaldeveloper.cn</a></p>
<h1 id="opscenter-VS-graphite-VS-newrelic"><a href="#opscenter-VS-graphite-VS-newrelic" class="headerlink" title="opscenter VS graphite VS newrelic"></a>opscenter VS graphite VS newrelic</h1><ol>
<li><a href="#环境部署">环境部署</a>    </li>
<li><a href="#收集的metrics对比">收集的metrics对比 </a><ul>
<li><a href="#cassandra-metrics">cassandra metrics</a></li>
<li><a href="#os-metrics">os metrics</a></li>
<li><a href="#application-metrics">application metrics</a></li>
</ul>
</li>
<li><a href="#扩展功能">扩展功能</a></li>
<li><a href="#开发维护成本">开发维护成本</a></li>
<li><a href="#cassandra 版本限制">cassandra 版本限制</a></li>
<li><a href="#总结">总结</a></li>
</ol>
<h2 id="环境部署"><a href="#环境部署" class="headerlink" title="环境部署"></a>环境部署</h2><p><strong>opscenter:</strong></p>
<p>从datastax 下载opscenter,install完了以后，就可以在opscenter 的UI 上面安装cassandra cluster,然后在cluster 上面安装opscenter agent.cassandra 和agent可以在opscenter 的UI上面安装，也可以在各个Node上面安装</p>
<p><strong>graphite:</strong></p>
<p>主要有三部分构成graphite 绘图，Carbon作为缓存，Whisper存储数据。此外通常需要使用grafana 来作为UI显示，因为graphite绘图太丑了，功能也有限。<br>graphite 环境搭建及配置及其复杂，需要安装很多的插件，所以版本适配也很麻烦。不过有了docker以后一切变得简单了。</p>
<p><a href="https://github.com/kamon-io/docker-grafana-graphite" title="github" target="_blank" rel="external">https://github.com/kamon-io/docker-grafana-graphite</a><br>(可以fork这个repo然后按照你的需求更改)</p>
<p>部署好graphite server，还需要在每个cassandra 配置发送<br>新建一个metrics.yaml</p>
<pre><code>graphite:
period: 30
timeunit: &apos;SECONDS&apos;
prefix: &apos;cassandra-cluster-prefix.node1&apos;
hosts:
 - host: &apos;xxx&apos;
   port: 2003
predicate:
  color: &quot;white&quot;
  useQualifiedName: true
  patterns:
    - &quot;^org.+&quot;
    - &quot;^jvm.+&quot;
    - &quot;^java.lang.+&quot;
</code></pre><p>然后在cassandra-env.sh 配置JVM启动项</p>
<pre><code>JVM_OPTS=&quot;$JVM_OPTS -Dcassandra.metricsReporterConfigFile=metrics.yaml&quot;
</code></pre><p><strong>newrelic:</strong></p>
<p>只用配置下newrelic 的config，然后run plugin</p>
<p><a href="https://github.com/threelegs/newrelic-plugins" target="_blank" rel="external">https://github.com/threelegs/newrelic-plugins</a></p>
<p><strong>warning</strong></p>
<p>newrelic cassandra 的plugin很多年没有更新了，所以应该支持Cassandra 2.x版本，不支持Cassandra 3.x的版本。<br>不过自己开发也很简单，只是有些metrics 名字，包名换了，可以自己fork下来进行修改。</p>
<p>opscenter=newrelic&gt;graphite(即使使用docker，graphite还是部署最复杂的一个)</p>
<h2 id="收集的metrics对比"><a href="#收集的metrics对比" class="headerlink" title="收集的metrics对比"></a>收集的metrics对比</h2><h3 id="cassandra-metrics"><a href="#cassandra-metrics" class="headerlink" title="cassandra metrics"></a>cassandra metrics</h3><p>cassandra metrics 主要就是JMX 暴露出来的MBean,包括Read/Write request,latency.还有一些是compaction task等信息。我们通过JConsole 工具就能够查看，不过是JConsole 界面过于丑陋，以及无法保存历史数据，绘制图形也不美观等种种缺点导致我们<br>不去使用它。</p>
<p>opscenter=graphite=newrelic cassandra metrics 三种收集方案都可以收集到，没什么差异。</p>
<h3 id="os-metrics"><a href="#os-metrics" class="headerlink" title="os metrics"></a>os metrics</h3><p>OS metrics 包括cpu,内存，disk使用情况。<br>opscenter集成在一起，看起来很方便；graphite需要使用第三方插件collectd进行收集；newrelic 同样也可以。</p>
<p>opscenter=newrelic&gt;graphite</p>
<h3 id="application-metrics"><a href="#application-metrics" class="headerlink" title="application metrics"></a>application metrics</h3><p>cassandra 是数据库服务，但是作为monitor，通常需要查看整体情况。client请求出现问题了，我们可能不仅需要分析<br>数据库，还需要分析application server.当然希望能够将application server 的信息与cassandra整合到同一页面<br>而不是多个监控平台。opscenter 没法做到，graphite 可以，newrelic 可以</p>
<p>graphite=newrelic&gt;opscenter</p>
<h2 id="扩展功能"><a href="#扩展功能" class="headerlink" title="扩展功能"></a>扩展功能</h2><p><strong>历史数据保存</strong></p>
<p>opscenter、graphite 都是支持参数配置保存多少天的。<br>newrelic 需要钱才可以保存更多天。</p>
<p><strong>权限管理</strong></p>
<p>opscenter支持admin对权限进行管理，但是所有的metrics作为一个整体，无法控制让某些用户只看某部分metrics<br><a href="https://docs.datastax.com/en/latest-opsc/opsc/configure/opscManageUsers.html" target="_blank" rel="external">https://docs.datastax.com/en/latest-opsc/opsc/configure/opscManageUsers.html</a></p>
<p>graphite 支持organization，不同的organization可以有不同的dashboard.organization中可以添加user，user 角色有四种admin,editor,read only editor,view. 不同的用户在不同的organization中可以有不同的角色。</p>
<p>newrelic 支持admin,user,restricted user三种，不同的用户可以看到不同的内容。</p>
<h2 id="开发维护成本"><a href="#开发维护成本" class="headerlink" title="开发维护成本"></a>开发维护成本</h2><p>opscenter 不需要开发，维护如果使用datastax 商业版的cassandra,交license费用即可。其他就是opscenter server的费用</p>
<p>graphite开源，但是环境部署需要时间和金钱，另外，graphite 有很多的插件构成整个monitor服务，这些插件的维护需要成本。<br>在作者搭建过程就遇到很多的问题。比如多个server的数据聚合问题，读取数据不正确。这些都是需要运营投入到更多的时间的。要是系统<br>不稳定，多投入一个运营，对于公司来说也是一笔不小的投入。</p>
<p>newrelic 有免费版，但是功能受限，像上面提到的历史数据保存，只能保存一天。收费版就不便宜了。<br>但是newrelic有个独有的好处，是SaaS服务。当需要监控的数据规模增多的时候，不用自己构建监控集群。<br>在这点上，opscenter，graphite.</p>
<p>金钱上<br>graphite&gt;opscenter&gt;newrelic</p>
<p>人力上 newrelic&gt;opscenter&gt;graphite</p>
<h2 id="cassandra-版本限制"><a href="#cassandra-版本限制" class="headerlink" title="cassandra 版本限制"></a>cassandra 版本限制</h2><p>opscenter最新版本只支持cassandra opensource 2.1,datastax enterprise 4.8,截止目前，cassandra opensource 已经release 3.7了。<br>所以opscenter 版本比较滞后。<br>graphite 是通用版本，可支持最新版本。<br>newrelic 是plugin形式，需要根据cassandra 更新的metrics来更新plugin 发送的metrics。</p>
<p>graphite=newrelic&gt;opscenter</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>无论从监控的metrics收集还是监控工具本身的管理来说，三种方案都能提供对应的解决方案。在其他方面略有差异</p>
<p>1.opscenter 很容易部署，另外集成了对cassandra 的常用操作。无需再登录到cassandra server 上，使用命令行来操作了。他本身不仅仅是个monitor工具，还是个cassandra的操作UI界面。opscenter 有个致命的缺点，cassandra版本受限，如果你想使用最新的cassandra<br>无法实现，这点上觉得是致命的缺陷，是因为一个辅助的监控工具，而影响到主要的数据库功能。</p>
<p>2.graphite<br>开源是graphite的优势，社区活跃是支撑。有人力能够投入尽快选用此方案。</p>
<p>3.newrelic 没有什么技术问题需要去解决，花钱解放生产力，如果监控的内容不是产品的核心，也未尝不是一种好方案</p>
<p>以上仅作者意见，只作参考</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="http://blog.ailms.me/2014/08/17/note-about-graphite-arch.html" target="_blank" rel="external">http://blog.ailms.me/2014/08/17/note-about-graphite-arch.html</a><br><a href="http://docs.grafana.org/troubleshooting/" target="_blank" rel="external">http://docs.grafana.org/troubleshooting/</a></p>

      
    </div>
	 <span id="busuanzi_container_page_pv">
      &nbsp;&nbsp;本文总阅读量<span id="busuanzi_value_page_pv"></span>次
    </span>
    <footer class="article-footer">
      <a data-url="http://www.webpersonaldeveloper.cn/2016/05/31/cassandra monitor/" data-id="ciovgpi20000b0wulsbjl4nui" class="article-share-link">Delen</a>
      
      
	  <div class="bdsharebuttonbox"><a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_qzone" data-cmd="qzone"></a><a href="#" class="bds_tsina" data-cmd="tsina"></a><a href="#" class="bds_tqq" data-cmd="tqq"></a><a href="#" class="bds_renren" data-cmd="renren"></a><a href="#" class="bds_weixin" data-cmd="weixin"></a></div>
      <script>window._bd_share_config=
	  {"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdPic":"","bdStyle":"0","bdSize":"16"},
	  "share":{},"image":{"viewList":["qzone","tsina","tqq","renren","weixin"],"viewText":"分享到：","viewSize":"16"},
	  "selectShare":{"bdContainerClass":null,"bdSelectMiniList":["qzone","tsina","tqq","renren","weixin"]}};
	  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
	  </script>	
	  <section id="comments">
    <!-- 多说评论框 start -->
    <div class="ds-thread" data-thread-key="post-cassandra monitor" data-title="cassandra monitor 方案评估" data-url="http://www.webpersonaldeveloper.cn/2016/05/31/cassandra monitor/"></div>
    <!-- 多说评论框 end -->
    <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
    <script type="text/javascript">
    var duoshuoQuery = {short_name:'webpersonaldeveloper'};
      (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] 
         || document.getElementsByTagName('body')[0]).appendChild(ds);
      })();
      </script>
    <!-- 多说公共JS代码 end -->
  </section>
    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2016/05/06/How to install dummynet on redhat/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Ouder</strong>
      <div class="article-nav-title">redhat7 上安装dummynet</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archieven</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recente berichten</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/05/31/cassandra monitor/">cassandra monitor 方案评估</a>
          </li>
        
          <li>
            <a href="/2016/05/06/How to install dummynet on redhat/">redhat7 上安装dummynet</a>
          </li>
        
          <li>
            <a href="/2016/05/05/git/">git 常用命令</a>
          </li>
        
          <li>
            <a href="/2016/05/05/cassandra-buildin-eclipse/">cassandra develop in eclipse 环境构建</a>
          </li>
        
          <li>
            <a href="/2016/04/29/cassandra-java-driver-log/">cassandra java driver log 配置</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  
</aside>
        
      </div>
      <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
<footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
	  <span id="busuanzi_container_site_pv">您是第<span id="busuanzi_value_site_pv"></span>个到达本站的人</span>
      &copy; 2016 Stone Fang<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>